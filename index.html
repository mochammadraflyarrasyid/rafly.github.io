<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistem Pengajuan Cuti PT.Rafly Production</title>
  <style>
    :root{
      --bg-dark: #071126;
      --card-dark: #0f1724;
      --accent: #2ea6ff;
      --muted: #9fb7d8;
      --text-dark: #071126;
      --text-light: #eef9ff;
      --success:#16a34a;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.06);
      --toast-bg: rgba(0,0,0,0.72);
    }
    [data-theme="light"]{
      --bg-dark: #e9f4ff;
      --card-dark: #ffffff;
      --accent: #0366d6;
      --muted: #234a63;
      --text-dark: #071126;
      --text-light: #07203a;
      --glass: rgba(0,0,0,0.04);
      --success:#0d8a2f;
      --danger:#c62828;
      --toast-bg: rgba(255,255,255,0.92);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg-dark);color:var(--text-light);
      transition: background .35s ease, color .35s ease;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }

    /* Lobby - RGB background */
    .lobby{min-height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:28px;text-align:center;position:relative;overflow:hidden;background:linear-gradient(120deg,#08132a 0%,#063440 50%,#0a2b4a 100%)}
    .rgb-layer{position:absolute;inset:-30% -30% -30% -30%;z-index:0;filter:blur(60px);opacity:0.9;background:linear-gradient(45deg,#ff0047,#e100ff,#4b6cff,#00f5a0,#ffd500);background-size:400% 400%;animation:rgbShift 12s linear infinite;mix-blend-mode:screen}
    @keyframes rgbShift{0%{background-position:0% 50%}25%{background-position:50% 50%}50%{background-position:100% 50%}75%{background-position:50% 50%}100%{background-position:0% 50%}}
    .lobby::before{content:"";position:absolute;inset:0;background:linear-gradient(0deg,rgba(0,0,0,0.35),rgba(0,0,0,0.45));z-index:1}

    .lobby-card{position:relative;z-index:2;max-width:820px;width:100%;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border-radius:14px;padding:22px;border:1px solid rgba(255,255,255,0.06);backdrop-filter:blur(6px);box-shadow:0 10px 40px rgba(2,6,23,0.6);color:var(--text-light)}
    .brand{font-weight:900;font-size:28px;letter-spacing:1px;margin-bottom:6px;color:var(--text-light);display:flex;align-items:center;gap:12px;justify-content:center}
    .brand .mark{width:46px;height:46px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;font-weight:800;background:linear-gradient(135deg,#7ce8ff,#0066ff);box-shadow:0 10px 30px rgba(46,166,255,0.18),0 0 30px rgba(123,104,255,0.12);color:#021229;font-size:18px;animation:markGlow 4s ease-in-out infinite}
    @keyframes markGlow{0%{filter:hue-rotate(0deg) saturate(100%)}50%{filter:hue-rotate(120deg) saturate(120%)}100%{filter:hue-rotate(240deg) saturate(100%)}}
    .subtitle{color:var(--muted);font-size:14px;margin-bottom:10px}
    .creator{margin-top:10px;font-size:14px;color:var(--text-light);font-weight:700}
    .creator small{display:block;font-weight:600;color:var(--muted);font-size:13px;margin-top:6px}
    .members{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:12px}
    .member{background:var(--glass);padding:8px 12px;border-radius:10px;font-size:13px;color:var(--text-light)}

    .enter-row{margin-top:18px;display:flex;gap:12px;justify-content:center;align-items:center}
    .enter-btn{padding:12px 22px;border-radius:999px;border:0;font-weight:800;font-size:16px;background:linear-gradient(90deg,rgba(255,255,255,0.95),rgba(230,250,255,0.95));color:var(--text-dark);cursor:pointer;box-shadow:0 8px 30px rgba(46,166,255,0.12),0 0 40px rgba(46,166,255,0.08);transition:transform .18s ease,box-shadow .18s ease;position:relative;overflow:visible}
    .enter-btn::after{content:"";position:absolute;inset:-6px;border-radius:999px;background:linear-gradient(90deg,#ff0047,#e100ff,#4b6cff,#00f5a0,#ffd500);filter:blur(18px);opacity:0.6;z-index:-1;animation:rgbShift 8s linear infinite}
    .enter-btn:hover{transform:translateY(-6px);box-shadow:0 20px 50px rgba(46,166,255,0.22)}
    .enter-btn:active{transform:translateY(-3px)}

    .particles{position:absolute;inset:0;z-index:0;pointer-events:none}
    .dot{position:absolute;width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,0.08);box-shadow:0 0 12px rgba(255,255,255,0.04)}

    /* App */
    .app{display:none;opacity:0;transition:opacity .45s ease}
    .app.visible{display:block;opacity:1}
    header.app-header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:linear-gradient(90deg,#003e86,#0073d1);color:white;box-shadow:0 6px 28px rgba(2,6,23,0.6)}
    .logo{display:flex;gap:12px;align-items:center}
    .logo .mark{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,#7ce8ff,#0066ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:#021229}
    .controls{display:flex;gap:10px;align-items:center}
    .container{max-width:1100px;margin:26px auto;background:var(--card-dark);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.03);color:var(--text-light)}
    h2.section{color:var(--accent);text-align:center;margin-bottom:12px}
    form{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-weight:700;font-size:13px;color:var(--muted)}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    textarea{resize:vertical}
    .actionsRow{text-align:center;margin-top:10px}
    .btn{padding:10px 12px;border-radius:8px;border:none;background:var(--accent);color:var(--text-dark);font-weight:800;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    table{width:100%;border-collapse:collapse;margin-top:16px;color:var(--text-light)}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:center;font-size:14px}
    th{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:var(--muted)}
    .status{padding:6px 8px;border-radius:8px;font-weight:800}
    .pending{background:rgba(255,200,60,0.12);color:#b86d00}
    .approved{background:rgba(34,197,94,0.12);color:var(--success)}
    .rejected{background:rgba(239,68,68,0.12);color:var(--danger)}
    .back-btn{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);backdrop-filter:blur(3px)}
    .modal .card{background:var(--card-dark);padding:18px;border-radius:12px;max-width:640px;border:1px solid rgba(255,255,255,0.04)}
    .closeModal{background:transparent;border:0;color:var(--muted);cursor:pointer}

    /* toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;padding:10px 16px;border-radius:10px;color:#fff;background:var(--toast-bg);z-index:9999;display:none;font-weight:700;backdrop-filter:blur(4px)}
    [data-theme="light"] .toast{color:var(--text-dark)}

    @media(max-width:900px){ form{grid-template-columns:1fr} .members{justify-content:center} }
  </style>
</head>
<body data-theme="dark">

  <!-- Lobby -->
  <div id="lobby" class="lobby" role="main" aria-label="Lobby Sistem">
    <div class="rgb-layer" aria-hidden="true"></div>

    <div class="lobby-card" role="region" aria-label="Informasi Lobby">
      <div class="brand">
        <div class="mark">R</div>
        <div>
          <div style="font-size:18px">Sistem Pengajuan Cuti <strong style="font-family:monospace">PT.Rafly Production</strong></div>
        </div>
      </div>

      <div class="subtitle">Aplikasi pengelolaan cuti karyawan</div>

      <div class="creator" style="margin-top:12px">
        Pembuat / Perancang Web:
      
        <div class=>Mochammad Rafly Arrasyid â€” 231011402624</div>
      </div>

      <div class="enter-row">
        <button id="enterBtn" class="enter-btn" aria-label="Masuk ke Sistem">Masuk ke Sistem</button>
      </div>
    </div>

    <div class="particles" aria-hidden="true"></div>
  </div>

  <!-- App -->
  <div id="app" class="app" role="application" aria-label="Aplikasi Sistem Cuti">
    <header class="app-header" role="banner">
      <div class="logo">
        <div class="mark">R</div>
        <div>
          <div style="font-weight:800">PT.Rafly Production</div>
          <div style="font-size:12px;color:rgba(255,255,255,0.9)">Sistem Pengajuan Cuti</div>
        </div>
      </div>

      <div class="controls">
        <button class="btn secondary" id="aboutBtn" title="Tentang Sistem">â„¹ Tentang</button>
        <button id="themeToggle" class="btn secondary" title="Mode Gelap/terang">ðŸŒ™</button>
        <button id="backLobby" class="back-btn" title="Kembali ke Lobby">â¬… Kembali ke Lobby</button>
      </div>
    </header>

    <main class="container" role="main">
      <h2 class="section">Form Pengajuan Cuti</h2>

      <form id="formCuti" aria-label="Form Pengajuan Cuti">
        <div>
          <label for="nama">Nama Karyawan</label>
          <input id="nama" type="text" required placeholder="Contoh: Anisa Putri">
        </div>
        <div>
          <label for="departemen">Departemen</label>
          <input id="departemen" type="text" required placeholder="Contoh: Human Resource">
        </div>
        <div>
          <label for="jenis">Jenis Cuti</label>
          <select id="jenis">
            <option value="Cuti Tahunan">Cuti Tahunan</option>
            <option value="Cuti Sakit">Cuti Sakit</option>
            <option value="Cuti Melahirkan">Cuti Melahirkan</option>
            <option value="Cuti Pribadi">Cuti Pribadi</option>
            <option value="Cuti Dinas">Cuti Dinas</option>
            <option value="Cuti Pernikahan">Cuti Pernikahan</option>
          </select>
        </div>
        <div>
          <label for="tglMulai">Tanggal Mulai</label>
          <input id="tglMulai" type="date" required>
        </div>
        <div>
          <label for="tglSelesai">Tanggal Selesai</label>
          <input id="tglSelesai" type="date" required>
        </div>

        <div style="grid-column:span 2">
          <label for="alasanPreset">Pilih Alasan Umum</label>
          <select id="alasanPreset">
            <option value="">-- Pilih (opsional) --</option>
            <option>Liburan keluarga</option>
            <option>Sakit dan perlu istirahat</option>
            <option>Persiapan kelahiran anak</option>
            <option>Mengurus keluarga</option>
            <option>Tugas dinas luar kota</option>
            <option>Pernikahan keluarga</option>
            <option>Operasi kecil</option>
            <option>Pelatihan kerja</option>
            <option>Penyelesaian administrasi penting</option>
            <option>Cuti karena pindah rumah</option>
          </select>
        </div>

        <div style="grid-column:span 2">
          <label for="alasan">Alasan Cuti (bisa tulis sendiri)</label>
          <textarea id="alasan" rows="3" placeholder="Tulis alasan detail di sini..."></textarea>
        </div>

        <div class="actionsRow" style="grid-column:span 2">
          <button class="btn" type="submit">Ajukan Cuti</button>
        </div>
      </form>

      <h2 class="section" style="margin-top:18px">Daftar Pengajuan Cuti</h2>
      <table id="tabelCuti" aria-live="polite">
        <thead>
          <tr><th>Nama</th><th>Departemen</th><th>Jenis</th><th>Periode</th><th>Status</th><th>Aksi</th></tr>
        </thead>
        <tbody></tbody>
      </table>

    </main>

    <footer style="text-align:center;padding:12px;color:var(--muted)">Â© <span id="year"></span> PT RABARMA Solutions â€” Kelompok</footer>
  </div>

  <div id="aboutModal" class="modal" style="display:none" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
    <div class="card">
      <h3 id="aboutTitle">Tentang Sistem</h3>
      <p>Sistem Pengajuan Cuti PT.Rafly Production. Dibuat oleh tim: Mochammad Rafly Arrasyid (Pembuat)</p>
      <div style="text-align:right;margin-top:12px"><button class="closeModal" id="closeAbout">Tutup</button></div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc, onSnapshot, updateDoc, deleteDoc, doc,
      serverTimestamp, query, orderBy, getDocs
    } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA9l_1gkMZuaSmDg2wxv7rJ9EhNDgLH1RQ",
      authDomain: "sistem-cuti-rabarma.firebaseapp.com",
      projectId: "sistem-cuti-rabarma",
      storageBucket: "sistem-cuti-rabarma.firebasestorage.app",
      messagingSenderId: "1043113356481",
      appId: "1:1043113356481:web:07e22aad8432829d857840",
      measurementId: "G-BBQ8J95PB4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const enterBtn = document.getElementById('enterBtn');
    const lobby = document.getElementById('lobby');
    const appView = document.getElementById('app');
    const backLobby = document.getElementById('backLobby');
    const themeToggle = document.getElementById('themeToggle');
    const aboutBtn = document.getElementById('aboutBtn');
    const aboutModal = document.getElementById('aboutModal');
    const closeAbout = document.getElementById('closeAbout');
    const yearSpan = document.getElementById('year');
    const toastEl = document.getElementById('toast');
    yearSpan.textContent = new Date().getFullYear();

    (function createDots(){
      const particles = document.querySelector('.particles');
      for(let i=0;i<28;i++){
        const d = document.createElement('div');
        d.className='dot';
        d.style.left = Math.random()*100 + '%';
        d.style.top = Math.random()*100 + '%';
        d.style.opacity = (0.12 + Math.random()*0.6).toFixed(2);
        d.style.transform = 'translate(-50%,-50%) scale(' + (0.6 + Math.random()*1.6) + ')';
        particles.appendChild(d);
      }
    })();

    function applyTheme(theme){
      document.documentElement.setAttribute('data-theme', theme);
      if(theme === 'light'){
        document.body.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim();
        themeToggle.textContent = 'â˜€ï¸';
      } else {
        document.body.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-light').trim();
        themeToggle.textContent = 'ðŸŒ™';
      }
      localStorage.setItem('rab_theme', theme);
    }
    (function initTheme(){
      const t = localStorage.getItem('rab_theme') || 'dark';
      applyTheme(t);
    })();
    themeToggle.addEventListener('click', ()=> applyTheme(document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light'));

    function showApp(){
      lobby.style.transition = 'opacity .45s ease';
      lobby.style.opacity = 0;
      setTimeout(()=> {
        lobby.style.display = 'none';
        appView.classList.add('visible');
        window.scrollTo({top:0,behavior:'smooth'});
      },460);
    }
    enterBtn.addEventListener('click', showApp);
    backLobby.addEventListener('click', ()=>{
      appView.classList.remove('visible');
      lobby.style.display = 'flex';
      setTimeout(()=> lobby.style.opacity = 1, 40);
      window.scrollTo({top:0,behavior:'smooth'});
    });

    aboutBtn.addEventListener('click', ()=> aboutModal.style.display = 'flex');
    closeAbout.addEventListener('click', ()=> aboutModal.style.display = 'none');
    document.addEventListener('keydown', (e)=> { if(e.key === 'Escape') aboutModal.style.display='none' });

    let toastTimer = null;
    function showToast(text, ms = 2000){
      clearTimeout(toastTimer);
      toastEl.style.display = 'block';
      toastEl.style.opacity = 1;
      toastEl.textContent = text;
      toastTimer = setTimeout(()=> {
        toastEl.style.opacity = 0;
        setTimeout(()=> toastEl.style.display = 'none', 300);
      }, ms);
    }

    const colRef = collection(db, 'dataCuti');
    const q = query(colRef, orderBy('createdAt','desc'));

    let initialized = false;

    const tbody = document.querySelector('#tabelCuti tbody');
    function renderRow(docData, docId){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(docData.nama || '')}</td>
        <td>${escapeHtml(docData.departemen || '')}</td>
        <td>${escapeHtml(docData.jenis || '')}</td>
        <td>${escapeHtml(docData.tglMulai || '')} - ${escapeHtml(docData.tglSelesai || '')}</td>
        <td><span class="status ${docData.status}">${escapeHtml(docData.status)}</span></td>
        <td>
          ${docData.status === 'pending' ? `<button class="btn secondary" onclick="ubahStatus('${docId}','approved')">Setujui</button>
          <button class="btn secondary" onclick="ubahStatus('${docId}','rejected')">Tolak</button>` : ''}
          <button class="btn secondary" onclick="hapusData('${docId}')">Hapus</button>
        </td>
      `;
      return tr;
    }

    onSnapshot(q, (snapshot) => {
      snapshot.docChanges().forEach(change => {
        if (change.type === 'added' && initialized) {
          const data = change.doc.data();
          showToast(`ðŸŸ¢ Pengajuan baru dari ${data.nama}`, 2500);
        }
      });

      tbody.innerHTML = '';
      snapshot.forEach((docSnap) => {
        const row = renderRow(docSnap.data(), docSnap.id);
        tbody.appendChild(row);
      });

      if(!initialized) initialized = true;
    }, (err) => {
      console.error("Firestore read error:", err);
      showToast("Gagal membaca data dari server");
    });

    async function addSubmission(payload){
      try {
        await addDoc(colRef, { ...payload, createdAt: serverTimestamp() });
        showToast("âœ… Pengajuan berhasil dikirim!", 1800);
      } catch (e){
        console.error(e);
        showToast("Gagal mengirim pengajuan");
      }
    }

    window.ubahStatus = async function(id, newStatus){
      try {
        await updateDoc(doc(db,'dataCuti', id), { status: newStatus });
        showToast(`Status diupdate: ${newStatus}`);
      } catch (e){
        console.error(e);
        showToast("Gagal mengubah status");
      }
    }

    window.hapusData = async function(id){
      if(!confirm("Hapus data ini?")) return;
      try {
        await deleteDoc(doc(db,'dataCuti', id));
        showToast("Data terhapus");
      } catch (e){
        console.error(e);
        showToast("Gagal menghapus data");
      }
    }

    function escapeHtml(str){ return String(str||'').replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    const form = document.getElementById('formCuti');
    const alasanPreset = document.getElementById('alasanPreset');
    const alasanTA = document.getElementById('alasan');

    alasanPreset.addEventListener('change', ()=> {
      if(alasanPreset.value) alasanTA.value = alasanPreset.value;
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const nama = document.getElementById('nama').value.trim();
      const departemen = document.getElementById('departemen').value.trim();
      const jenis = document.getElementById('jenis').value;
      const tglMulai = document.getElementById('tglMulai').value;
      const tglSelesai = document.getElementById('tglSelesai').value;
      const alasanVal = document.getElementById('alasan').value.trim();

      if(!nama || !departemen || !tglMulai || !tglSelesai){
        showToast("Lengkapi form terlebih dahulu");
        return;
      }

      const payload = { nama, departemen, jenis, tglMulai, tglSelesai, alasan: alasanVal || '', status: 'pending' };
      addSubmission(payload);
      form.reset();
    });

    async function seedDataIfEmpty(){
      try {
        const snap = await getDocs(collection(db,'dataCuti'));
        if(snap.empty){
          const namaOrang = [
            "Anisa Putri","Dimas Setiawan","Rani Prameswari","Rio Aditya","Siti Lestari",
            "Andri Wijaya","Nina Kurnia","Fadil Hidayat","Maya Sari","Rizal Fahmi",
            "Ika Nurul","Hendra Pratama","Lia Marlina","Farhan Akbar","Vina Permata",
            "Bayu Santoso","Wulan Ayu","Ardi Gunawan","Salsa Pertiwi","Fikri Ramadhan",
            "Nadia Zahra","Rendy Saputra","Putri Anggraini","Denny Prasetyo","Melati Kusuma",
            "Wahyu Hidayat","Dewi Lestari","Rico Firmansyah","Siti Aminah","Yoga Prasetyo"
          ];
          const departemenList = ["Human Resource","Finance","IT Support","Marketing","Produksi","Customer Service","R&D","Logistik"];
          const jenisList = ["Cuti Tahunan","Cuti Sakit","Cuti Melahirkan","Cuti Pribadi","Cuti Dinas","Cuti Pernikahan"];
          const alasanList = [
            "Liburan keluarga","Sakit dan perlu istirahat","Persiapan kelahiran anak","Mengurus keluarga",
            "Tugas dinas luar kota","Pernikahan keluarga","Operasi kecil","Pelatihan kerja",
            "Penyelesaian administrasi penting","Cuti karena pindah rumah"
          ];
          for(let i=0;i<30;i++){
            const nama = namaOrang[i % namaOrang.length];
            const departemen = departemenList[i % departemenList.length];
            const jenis = jenisList[i % jenisList.length];
            const alasan = alasanList[i % alasanList.length];
            const start = new Date(2025, 9, 1 + (i % 20));
            const end = new Date(start); end.setDate(start.getDate() + (1 + (i%4)));
            await addDoc(collection(db,'dataCuti'), {
              nama, departemen, jenis,
              tglMulai: start.toISOString().slice(0,10),
              tglSelesai: end.toISOString().slice(0,10),
              alasan, status: ['pending','approved','rejected'][i%3],
              createdAt: serverTimestamp()
            });
          }
        }
      } catch (e){
        console.error("Seed error:", e);
      }
    }
    seedDataIfEmpty();

    window.addEventListener('beforeunload', ()=> localStorage.setItem('rab_theme', document.documentElement.getAttribute('data-theme') || 'dark'));

  </script>
</body>
</html>
